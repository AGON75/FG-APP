<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Admin â€“ Planification Finger Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { background: #111; color: white; font-family: sans-serif; padding: 20px; }
    select, button, input { font-size: 16px; padding: 6px; margin: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #333; padding: 8px; text-align: left; }
    th { background: #222; }
  </style>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
    const supabase = createClient(
      'https://ckolzmqarfizoxjgolft.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNrb2x6bXFhcmZpem94amdvbGZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2Nzg3NTYsImV4cCI6MjA2NTI1NDc1Nn0.ZlpERz1uznM0fn--GR9YgM2vjwe_kw-qiPF8KHJvMpI'
    );

    async function genererPhase() {
      const phase = parseInt(document.getElementById("phase").value);
      const round = document.getElementById("round").value;

      const { data: joueurs } = await supabase
        .from("players")
        .select("*")
        .order("matches", { ascending: true });

      if (!joueurs || joueurs.length === 0) return alert("Aucun joueur trouvÃ©.");

      // Filtrer ceux qui nâ€™ont pas encore Ã©tÃ© affectÃ©s Ã  cette phase + round
      const disponibles = joueurs.filter(j => !j.phase || !j.round);

      if (disponibles.length < 50) alert("âš  Moins de 50 joueurs disponibles (possible overlap).");

      // RÃ©partition intelligente : 5 terrains de 10 joueurs
      const groupes = Array.from({ length: 5 }, () => []);
      disponibles.slice(0, 50).forEach((j, i) => {
        const terrain = (i % 5) + 1;
        groupes[terrain - 1].push({ ...j, terrain });
      });

      // MAJ dans Supabase
      for (const groupe of groupes) {
        for (const joueur of groupe) {
          await supabase.from("players").update({
            phase: phase,
            round: round,
            terrain: joueur.terrain
          }).eq("id", joueur.id);
        }
      }

      // Affichage du planning
      const affichage = document.getElementById("planning");
      affichage.innerHTML = `<h3>Planning â€“ Phase ${phase} ${round}</h3>`;
      groupes.forEach((groupe, i) => {
        affichage.innerHTML += `<h4>Terrain ${i + 1}</h4><ul>` +
          groupe.map(j => `<li>${j.name}</li>`).join("") + "</ul>";
      });

      alert("âœ… Phase gÃ©nÃ©rÃ©e !");
    }

    window.genererPhase = genererPhase;
  </script>
</head>
<body>
  <h1>ğŸ§  Planification des phases â€“ Finger Game</h1>

  <label>ğŸ“Œ Phase :</label>
  <select id="phase">
    <option value="1">Phase 1</option>
    <option value="2">Phase 2</option>
    <option value="3">Phase 3</option>
    <option value="4">Phase 4</option>
    <option value="5">Phase 5</option>
  </select>

  <label>ğŸ” Round :</label>
  <select id="round">
    <option value="A">A</option>
    <option value="B">B</option>
  </select>

  <button onclick="genererPhase()">ğŸ² GÃ©nÃ©rer la phase</button>

  <div id="planning" style="margin-top: 20px;"></div>
</body>
</html>
