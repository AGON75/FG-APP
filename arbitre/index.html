<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Arbitre ‚Äì R√©affectation al√©atoire</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { background: #111; color: white; font-family: sans-serif; padding: 20px; }
    button, select { font-size: 16px; margin: 5px; padding: 10px; }
  </style>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    const supabase = createClient(
      'https://ckolzmqarfizoxjgolft.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNrb2x6bXFhcmZpem94amdvbGZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2Nzg3NTYsImV4cCI6MjA2NTI1NDc1Nn0.ZlpERz1uznM0fn--GR9YgM2vjwe_kw-qiPF8KHJvMpI'
    );

    async function reaffecterEtCharger() {
      const terrainSelectionne = parseInt(document.getElementById("terrain").value);
      const { data: joueurs, error } = await supabase.from("players").select("*");
      if (error) return alert("Erreur chargement joueurs");

      for (let joueur of joueurs) {
        let nouveau;
        do {
          nouveau = Math.floor(Math.random() * 5) + 1;
        } while (nouveau === joueur.terrain);

        await supabase
          .from("players")
          .update({ terrain: nouveau })
          .eq("id", joueur.id);
      }

      // Charger les joueurs du terrain s√©lectionn√©
      const { data: filtres } = await supabase
        .from("players")
        .select("*")
        .eq("terrain", terrainSelectionne);

      const zone = document.getElementById("joueurs");
      zone.innerHTML = `<h3>Joueurs sur la piste ${terrainSelectionne}</h3><ul>` +
        filtres.map(j => `<li>${j.name}</li>`).join("") + "</ul>";
    }

    window.onload = () => {
      const sel = document.getElementById("terrain");
      for (let i = 1; i <= 5; i++) {
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = "Piste " + i;
        sel.appendChild(opt);
      }
    };

    window.reaffecterEtCharger = reaffecterEtCharger;
  </script>
</head>
<body>
  <h1>R√©affectation al√©atoire des joueurs</h1>
  <label>Choisir terrain arbitr√© :</label>
  <select id="terrain"></select>
  <button onclick="reaffecterEtCharger()">üîÄ R√©affecter + Charger</button>
  <div id="joueurs" style="margin-top: 20px;"></div>
</body>
</html>
